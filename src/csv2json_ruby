#!/usr/bin/env ruby1.9.1

require_relative 'csv2json_ruby_lib'

def exit_error(msg)
        $err_log.error(msg)
        exit 20
end

def exit_usage(msg = nil)
    if msg != nil
        puts "\nERROR:\n\n\t#{msg}\n"
    end

    puts "\nUsage:\n\n\t#{$PROGRAM_NAME} srcCsvFname dstJsonFname\n\n"
    exit 20
end

def main ()
    srcCsvFname, dstJsonFname = ARGV

    if dstJsonFname == nil
        exit_usage("Not enough arguments given")
    end

    do_stockitem_csv2json_conversion(srcCsvFname, dstJsonFname, lambda { |r| stockitem_mapper(r) })
    exit 0

rescue IOError => e
    exit_error("IOError: #{e}.  Couldn't complete conversion process.")

end

main

